<!doctype html>
<html lang="zh-Hant">

    <head>
        <meta charset="utf-8">
        <title>Pixel Aquarium</title>
        <!-- Favicon / 網站小圖示 -->
        <link rel="icon" type="image/png" sizes="32x32" href="fish7.png">
        <link rel="icon" type="image/png" sizes="192x192" href="fish7.png">

        <!-- iOS / Android 主畫面捷徑圖示 -->
        <link rel="apple-touch-icon" sizes="180x180" href="fish7.png">

        <style>
            * {
                box-sizing: border-box;
                margin: 0;
                padding: 0;
            }

            body {
                min-height: 100vh;
                display: flex;
                align-items: center;
                justify-content: center;
                background: #0b1020;
                font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
            }

            .aquarium {
                position: relative;
                width: 800px;
                height: 400px;
                border-radius: 24px;
                border: 4px solid #ffffff88;
                overflow: hidden;
                box-shadow: 0 20px 40px rgba(0, 0, 0, 0.5);
                background: radial-gradient(circle at 20% 0%, #4fd1ff30 0, transparent 50%),
                    radial-gradient(circle at 80% 100%, #9ae6b430 0, transparent 55%),
                    linear-gradient(#0b3a6a, #031322);
            }

            /* 瘞?部 */
            .bubble {
                position: absolute;
                width: 6px;
                height: 6px;
                border-radius: 50%;
                background: #ffffff66;
                filter: blur(0.3px);
                bottom: -200px;
                /* start well below view */
                animation: bubble-up 14s linear infinite;
                animation-fill-mode: both;
                opacity: 0;
                z-index: 10;
            }

            /* avoid flash before animations are ready */
            .aquarium:not(.bubbles-ready) .bubble {
                opacity: 0 !important;
                animation: none !important;
            }

            @keyframes bubble-up {
                0% {
                    transform: translateY(0);
                    opacity: 0;
                }

                18% {
                    opacity: 0;
                }

                30% {
                    opacity: 0.85;
                }

                100% {
                    transform: translateY(-600px);
                    opacity: 0;
                }
            }

            .bubble.b1 {
                left: 10%;
                animation-duration: 9s;
                animation-delay: 0s;
            }

            .bubble.b2 {
                left: 25%;
                animation-duration: 12s;
                animation-delay: 2s;
            }

            .bubble.b3 {
                left: 40%;
                animation-duration: 11s;
                animation-delay: 4s;
            }

            .bubble.b4 {
                left: 60%;
                animation-duration: 10s;
                animation-delay: 1s;
            }

            .bubble.b5 {
                left: 80%;
                animation-duration: 13s;
                animation-delay: 3s;
            }

            /* 瘞渲?摨雿蔭 */
            .plant {
                position: absolute;
                bottom: 0;
                image-rendering: pixelated;
                pointer-events: none;
                /* 銝蔣?輸?擳?*/
                z-index: 1;
            }

            /* ?剖瘞渲???曆?蝵株?憭批?嚗???末敺株矽 */
            .p1 {
                left: -5%;
                width: 5%;
            }

            .p2 {
                left: 12%;
                width: 8%;
            }

            .p3 {
                left: 30%;
                width: 10%;
                z-index: 2;

            }

            .p4 {
                left: 70%;
                width: 8%;
            }

            .p5 {
                left: 60%;
                width: 8%;
                z-index: 2;

            }

            .p6 {
                left: 80%;
                width: 6%;
            }

            .p7 {
                left: -3%;
                width: 6%;
                z-index: 2;
            }

            .p8 {
                left: 20%;
                width: 12%;
            }

            .p9 {
                left: -10%;
                width: 20%;
            }

            .p10 {
                left: 75%;
                width: 12%;
            }

            .p11 {
                left: 90%;
                width: 20%;
            }

            .p12 {
                left: 20%;
                width: 6%;
            }


            /* 擳?*/
            .fish {
                position: absolute;
                image-rendering: pixelated;
                width: 90px;
                pointer-events: auto;
                /* 閬鋡恍???*/
                transform: scaleX(1);
                /* ???椰 */
                z-index: 5;
            }

            .f1 {
                top: 40px;
            }

            .f2 {
                top: 90px;
            }

            .f3 {
                top: 150px;
            }

            .f4 {
                top: 210px;
            }

            .f5 {
                top: 260px;
            }

            .f6 {
                top: 310px;
            }

            .f7 {
                top: 130px;
            }

            .f8 {
                top: 230px;
            }

            .f9 {
                top: 60px;
            }

            .pellet {
                position: absolute;
                width: 10px;
                height: 10px;
                border-radius: 50%;
                background: linear-gradient(135deg, #f1b55d, #d07a2d);
                box-shadow: 0 0 8px rgba(255, 191, 94, 0.6);
                opacity: 0.92;
                z-index: 4;
                transition: top 0.9s ease-out, opacity 0.3s ease;
            }

            .pellet.eaten {
                opacity: 0;
                transition: opacity 0.3s ease;
            }
        </style>
        <!-- Google tag (gtag.js) -->
        <script async src="https://www.googletagmanager.com/gtag/js?id=G-WGLG9GE3K7"></script>
        <script>
            window.dataLayer = window.dataLayer || [];

            function gtag() {
                dataLayer.push(arguments);
            }
            gtag('js', new Date());

            gtag('config', 'G-WGLG9GE3K7');
        </script>
    </head>

    <body>
        <div class="aquarium">
            <img src="g1.png" class="plant p1" alt="plant 1">
            <img src="g2.png" class="plant p2" alt="plant 2">
            <img src="g3.png" class="plant p3" alt="plant 3">
            <img src="g4.png" class="plant p4" alt="plant 4">
            <img src="g5.png" class="plant p5" alt="plant 5">
            <img src="g6.png" class="plant p6" alt="plant 6">
            <img src="g1.png" class="plant p7" alt="plant 1">
            <img src="g2.png" class="plant p8" alt="plant 2">
            <img src="g3.png" class="plant p9" alt="plant 3">
            <img src="g4.png" class="plant p10" alt="plant 4">
            <img src="g5.png" class="plant p11" alt="plant 5">
            <img src="g6.png" class="plant p12" alt="plant 6">

            <div class="bubble b1"></div>
            <div class="bubble b2"></div>
            <div class="bubble b3"></div>
            <div class="bubble b4"></div>
            <div class="bubble b5"></div>

            <img src="fish1.png" class="fish f1" alt="">
            <img src="fish2.png" class="fish f2" alt="">
            <img src="fish3.png" class="fish f3" alt="">
            <img src="fish4.png" class="fish f4" alt="">
            <img src="fish5.png" class="fish f5" alt="">
            <img src="fish6.png" class="fish f6" alt="">
            <img src="fish7.png" class="fish f7" alt="">
            <img src="fish8.png" class="fish f8" alt="">
            <img src="fish9.png" class="fish f9" alt="">
        </div>

        <script>
            // 初始化水族箱元件
            const aquarium = document.querySelector('.aquarium');
            const fishEls = Array.from(document.querySelectorAll('.fish'));
            const plantEls = Array.from(document.querySelectorAll('.plant'));

            // 啟用泡泡動畫（避免載入瞬間閃現）
            requestAnimationFrame(() => aquarium.classList.add('bubbles-ready'));

            // 初始化魚的資料
            const fishes = fishEls.map((el) => {
                const speed = 0.6 + Math.random() * 0.6; // 基礎速度（慢一點）
                const dir = Math.random() < 0.5 ? -1 : 1; // -1 往左、1 往右
                const maxLeft = aquarium.clientWidth - el.offsetWidth;
                const startLeft = Math.random() * maxLeft;
                const startTop = parseFloat(getComputedStyle(el).top);
                el.style.left = startLeft + 'px';
                el.style.top = startTop + 'px';
                el.style.transform = dir === 1 ? 'scaleX(-1)' : 'scaleX(1)';

                return {
                    el,
                    speed,
                    currentSpeed: speed,
                    dir,
                    scared: false,
                    recoverTimer: null,
                    top: startTop,
                    targetFood: null,
                    driftDir: Math.random() < 0.5 ? -1 : 1,
                    driftSpeed: 0.2 + Math.random() * 0.3,
                    driftTimer: 600 + Math.random() * 800
                };
            });

            // 點擊魚 → 加速前進
            fishes.forEach(fish => {
                fish.el.addEventListener('click', () => {
                    if (fish.recoverTimer) clearTimeout(fish.recoverTimer);
                    fish.scared = true;
                    fish.currentSpeed = fish.speed * 3;
                    fish.el.style.transform = fish.dir === 1 ? 'scaleX(-1)' : 'scaleX(1)';
                    fish.recoverTimer = setTimeout(() => {
                        fish.currentSpeed = fish.speed;
                        fish.scared = false;
                    }, 2000);
                });
            });

            // 飼料列表
            const foods = [];
            const maxFood = 8;
            const pelletRadius = 5;
            const fallSpeed = 0.35; // px per ms

            function removeFood(food) {
                if (food.stopTimer) {
                    clearTimeout(food.stopTimer);
                    food.stopTimer = null;
                }
                const idx = foods.indexOf(food);
                if (idx >= 0) {
                    foods.splice(idx, 1);
                }
                if (food.el.parentNode) {
                    food.el.remove();
                }
            }

            function computeStopY(centerX) {
                const rect = aquarium.getBoundingClientRect();
                let stop = rect.height - pelletRadius - 2; // 水缸底

                plantEls.forEach(plant => {
                    const r = plant.getBoundingClientRect();
                    const left = r.left - rect.left;
                    const right = left + r.width;
                    if (centerX >= left && centerX <= right) {
                        const top = r.top - rect.top;
                        const candidate = top - pelletRadius;
                        if (candidate < stop) stop = candidate;
                    }
                });
                return stop;
            }

            function dropFood(x, y) {
                const rect = aquarium.getBoundingClientRect();
                const clampedX = Math.max(8, Math.min(rect.width - 18, x));
                const stopY = computeStopY(clampedX + pelletRadius);
                const startY = Math.min(stopY, typeof y === 'number' ? y : -13);

                if (foods.length >= maxFood) {
                    const oldest = foods.shift();
                    removeFood(oldest);
                }

                const pellet = document.createElement('div');
                pellet.className = 'pellet';
                pellet.style.left = clampedX + 'px';
                pellet.style.top = (startY - pelletRadius) + 'px';
                aquarium.appendChild(pellet);

                const food = { el: pellet, x: clampedX + pelletRadius, y: startY, stopped: false, stopTimer: null };
                foods.push(food);

                let lastFall = performance.now();
                function fall(now) {
                    const delta = now - lastFall;
                    lastFall = now;
                    if (!food.stopped) {
                        const stop = computeStopY(food.x);
                        food.y = Math.min(stop, food.y + fallSpeed * delta);
                        if (food.y >= stop) {
                            food.y = stop;
                            food.stopped = true;
                            food.stopTimer = setTimeout(() => removeFood(food), 2000);
                        }
                        pellet.style.top = (food.y - pelletRadius) + 'px';
                    }
                    if (!food.stopped) requestAnimationFrame(fall);
                }
                requestAnimationFrame(fall);
            }

            function dropAtPoint(clientX, clientY) {
                const rect = aquarium.getBoundingClientRect();
                const x = clientX - rect.left;
                const y = clientY - rect.top;
                if (x < 0 || x > rect.width || y < 0 || y > rect.height) {
                    const randomX = rect.width * (0.35 + Math.random() * 0.3);
                    const randomY = rect.height * (0.4 + Math.random() * 0.5);
                    dropFood(randomX, randomY);
                } else {
                    dropFood(x, y);
                }
            }

            aquarium.addEventListener('pointerdown', (e) => {
                if (e.target.closest('.fish')) return;
                dropAtPoint(e.clientX, e.clientY);
            });

            document.body.addEventListener('pointerdown', (e) => {
                if (e.target.closest('.aquarium')) return;
                dropAtPoint(e.clientX, e.clientY);
            });

            let lastTime = null;

            function animate(time) {
                if (!lastTime) lastTime = time;
                const delta = time - lastTime;
                lastTime = time;

                const aqWidth = aquarium.clientWidth;
                const aqHeight = aquarium.clientHeight;

                fishes.forEach(fish => {
                    const el = fish.el;
                    const fishWidth = el.offsetWidth;
                    const fishHeight = el.offsetHeight;
                    const maxLeft = aqWidth - fishWidth;

                    let left = parseFloat(el.style.left) || 0;
                    let top = fish.top;

                    // 找最近飼料
                    if (foods.length === 0) {
                        fish.targetFood = null;
                    } else if (!fish.targetFood || !foods.includes(fish.targetFood)) {
                        let closest = null;
                        let bestDist = Infinity;
                        foods.forEach(food => {
                            const dx = (left + fishWidth / 2) - food.x;
                            const dy = (top + fishHeight / 2) - food.y;
                            const dist = Math.hypot(dx, dy);
                            if (dist < bestDist) {
                                bestDist = dist;
                                closest = food;
                            }
                        });
                        fish.targetFood = closest;
                    }

                    const moveMultiplier = fish.targetFood ? 1.6 : 1;
                    left += fish.dir * fish.currentSpeed * moveMultiplier * (delta / 16);

                    if (left <= 0) {
                        left = 0;
                        fish.dir = 1;
                        fish.el.style.transform = 'scaleX(-1)';
                    } else if (left >= maxLeft) {
                        left = maxLeft;
                        fish.dir = -1;
                        fish.el.style.transform = 'scaleX(1)';
                    }

                    if (fish.targetFood) {
                        const target = fish.targetFood;
                        const dx = target.x - (left + fishWidth / 2);
                        const dy = target.y - (top + fishHeight / 2);

                        if (Math.abs(dx) > 4) {
                            fish.dir = dx > 0 ? 1 : -1;
                            fish.el.style.transform = fish.dir === 1 ? 'scaleX(-1)' : 'scaleX(1)';
                        }

                        top += Math.max(-3, Math.min(3, dy * 0.05 * moveMultiplier));
                        top = Math.max(10, Math.min(aqHeight - fishHeight - 10, top));

                        const dist = Math.hypot(dx, dy);
                        if (dist < 18) {
                            target.el.classList.add('eaten');
                            removeFood(target);
                            fish.targetFood = null;
                        }
                    } else {
                        // 沒有飼料時的隨機漂移
                        fish.driftTimer -= delta;
                        if (fish.driftTimer <= 0) {
                            fish.driftDir = Math.random() < 0.5 ? -1 : 1;
                            fish.driftSpeed = 0.2 + Math.random() * 0.3;
                            fish.driftTimer = 600 + Math.random() * 800;
                        }
                        top += fish.driftDir * fish.driftSpeed * (delta / 16);
                        if (top <= 10) {
                            top = 10;
                            fish.driftDir = 1;
                        } else if (top >= aqHeight - fishHeight - 10) {
                            top = aqHeight - fishHeight - 10;
                            fish.driftDir = -1;
                        }
                    }

                    fish.top = top;
                    el.style.top = top + 'px';
                    el.style.left = left + 'px';
                });

                requestAnimationFrame(animate);
            }

            requestAnimationFrame(animate);
        </script>
    </body>

</html>